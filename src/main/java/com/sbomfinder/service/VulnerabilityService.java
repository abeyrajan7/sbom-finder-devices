package com.sbomfinder.service;

import com.sbomfinder.dto.VulnerabilityDTO;
import com.sbomfinder.model.SoftwarePackage;
import com.sbomfinder.model.Vulnerability;
import com.sbomfinder.repository.SoftwarePackageRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.Set;
import java.util.stream.Collectors;
import java.util.Optional;
import java.util.ArrayList;

@Service
public class VulnerabilityService {
    @Autowired
    private SoftwarePackageRepository softwarePackageRepository;
    public List<VulnerabilityDTO> getVulnerabilitiesByPackageId(Long packageId) {
        Optional<SoftwarePackage> optionalPkg = softwarePackageRepository.findById(packageId);
        if (optionalPkg.isEmpty()) return new ArrayList<>();
        SoftwarePackage pkg = optionalPkg.get();

        return pkg.getVulnerabilities().stream().map(v -> {
            VulnerabilityDTO dto = new VulnerabilityDTO();
            dto.setCveId(v.getCveId());
            dto.setDescription(v.getDescription());
            dto.setSeverity(v.getSeverity());
            dto.setSourceUrl(v.getSourceUrl());
            dto.setSeverityLevel(dto.getSeverityLevel());
            return dto;
        }).collect(Collectors.toList());
    }
}

